# Precompiled Binary Dependencies

Этот подход позволяет избежать компиляции тяжелых Swift Package зависимостей в CI, значительно ускоряя тесты.

## Как это работает

1. **Локально**: Запускаете скрипт `prepare_binary_dependencies.sh`, который компилирует все зависимости
2. **В репозитории**: Закоммичиваете предкомпилированные `SourcePackages` 
3. **В CI**: Скрипт `test_ci.sh` автоматически использует предкомпилированные зависимости вместо компиляции

## Использование

### Первоначальная настройка

1. Обновите зависимости до нужных версий в Xcode
2. Запустите скрипт подготовки:
   ```bash
   ./ios-sdk/libs/prepare_binary_dependencies.sh
   ```
3. Проверьте размер:
   ```bash
   du -sh ios-sdk/libs/SourcePackages
   ```
4. Добавьте в Git (рекомендуется использовать Git LFS для больших файлов):
   ```bash
   # Если используете Git LFS
   git lfs track "ios-sdk/libs/SourcePackages/**"
   git add ios-sdk/libs/SourcePackages
   git commit -m "Add precompiled Swift Package dependencies"
   ```

### Обновление зависимостей

Когда нужно обновить зависимости:

1. Обновите версии в Xcode
2. Запустите `prepare_binary_dependencies.sh` снова
3. Закоммитьте обновленные `SourcePackages`

### В CI

Скрипт `test_ci.sh` автоматически обнаружит и использует предкомпилированные зависимости, если они есть в репозитории.

## Размер

Предкомпилированные зависимости могут занимать:
- **swift-crypto**: ~50-100 MB
- **swift-openapi-runtime**: ~10-20 MB
- **swift-certificates**: ~20-30 MB
- **Остальные**: ~20-30 MB
- **Итого**: ~100-200 MB

## Альтернативы

Если размер репозитория критичен:

1. **Git LFS**: Используйте Git LFS для хранения больших бинарных файлов
2. **Отдельный репозиторий**: Храните бинарники в отдельном репозитории и скачивайте в CI
3. **Артефакты GitHub Actions**: Храните бинарники как артефакты и скачивайте в CI

## Преимущества

- ✅ **Быстрее CI**: Компиляция зависимостей занимает 10-30 минут, с предкомпилированными - секунды
- ✅ **Надежнее**: Нет зависаний на компиляции больших модулей (CCryptoBoringSSL)
- ✅ **Проще**: Не требует изменений в структуре проекта

## Недостатки

- ❌ **Размер репозитория**: Увеличивает размер на ~100-200 MB
- ❌ **Обслуживание**: Нужно обновлять при изменении зависимостей
- ❌ **Версионирование**: Нужно следить за совместимостью версий Swift/Xcode

